#!/usr/bin/env ruby
if ARGV.delete '-t'
  test_files = ARGV.map { |arg|
    unless arg.index('-') == 0
      if File.directory? arg
        Dir["#{arg}/**/*_test.rb", "#{arg}/**/test_*.rb"]
      else
        arg
      end
    end
  }.compact.flatten
  
  if test_files.empty?
    warn "polyamory: nothing to load"
    exit 1
  else
    test_files.each { |f| load f }
  end
else
  require 'polyamory'
  options = {}
  options[:noop] = !!ARGV.delete('-n')
  Polyamory.run ARGV, Dir.pwd, options
end
